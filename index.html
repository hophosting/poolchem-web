<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PoolChem Assistant</title>
  <style>
    body {font-family: 'Segoe UI', sans-serif; background:#e9f9ff; margin:0; display:flex; flex-direction:column; align-items:center;}
    h1 {color:#0077b6; margin-top:30px;}
    form {background:white; padding:20px; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.1); width:320px;}
    label {display:block; margin-top:10px;}
    input, textarea {width:100%; padding:8px; margin-top:5px; border:1px solid #ccc; border-radius:5px;}
    button {margin-top:15px; background:#0096c7; color:white; border:none; padding:10px; width:100%; border-radius:5px; font-size:16px; cursor:pointer;}
    button:hover {background:#0077b6;}
    #report {max-width:600px; background:white; margin-top:20px; padding:20px; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.1); white-space:pre-wrap;}
  </style>
</head>
<body>
  <h1>PoolChem Assistant</h1>
  <form id="pool-form">
    <label>Pool Volume (L): <input type="number" name="pool_volume" required></label>
    <label>Free Chlorine (ppm): <input type="number" name="free_chlorine" required></label>
    <label>Total Chlorine (ppm): <input type="number" name="total_chlorine"></label>
    <label>pH: <input type="number" step="0.1" name="pH" required></label>
    <label>Total Alkalinity (ppm): <input type="number" name="total_alkalinity"></label>
    <label>Cyanuric Acid (ppm): <input type="number" name="cyanuric_acid"></label>
    <label>Total Hardness (ppm): <input type="number" name="total_hardness"></label>
    <label>ORP (mV): <input type="number" name="orp"></label>
    <label>Phosphates (ppb): <input type="number" name="phosphates"></label>
    <label>Notes:<textarea name="notes" rows="3"></textarea></label>
    <button type="submit">Generate Report</button>
  </form>

  <div id="report">Your treatment report will appear here...</div>

  <script>
    document.getElementById("pool-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      const form = e.target;
      const formData = Object.fromEntries(new FormData(form));

      // 1. Call your Render API to normalise data
      const res = await fetch("https://poolchem-api.onrender.com/analyse", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(formData)
      });
      const apiData = await res.json();

      // 2. Send that to your local Vercel server route to ask GPT
      const gptRes = await fetch("/api/report", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(apiData.inputs)
      });
      const text = await gptRes.text();
      document.getElementById("report").textContent = text;
    });
  </script>
</body>
</html>
